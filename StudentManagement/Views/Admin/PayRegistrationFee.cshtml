@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewBag.Title = "Pay Registration Fee - Admin";
    Layout = "_AdminLayout";

}

<div class="w-full min-h-screen bg-gray-100 flex justify-center items-center p-4">
    <div class="bg-white rounded-lg w-full max-w-2xl p-6">
        <h1 class="text-center text-3xl font-bold">Pay Registration Fee</h1>
        <p class="text-center text-gray-400">Complete your registration by paying the one-time fee. Secure checkout powered by Razorpay.</p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4 mb-4">
            @* Left side *@
            <div class="bg-sky-50 p-4 rounded-lg">
                <div class="flex justify-center align-center mt-6 mb-6">
                    <div class="rounded-lg w-[100px] h-[100px]">
                        <img src="~/images/genius.jpg" class="rounded-full w-24 h-24 mx-auto" />
                    </div>
                </div>

                <p class="text-center text-lg text-gray-400">Genius Coaching Center</p>
                <p class="text-center text-md text-gray-500">Registration Fee</p>

                <div class="w-full d-flex justify-center mt-4">
                    <div class="bg-white p-3 rounded-lg">
                        <p class="text-center text-gray-500">Amount</p>
                        <p class="text-center text-lg text-blue-400"><i class="fa-solid fa-indian-rupee-sign"></i> @TempData["amount"]</p>
                    </div>
                </div>
            </div>

            @* Right side *@
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="d-3 border rounded-lg p-4">
                    <p class="text-center text-gray-500">Student Name</p>
                    <p class="text-center text-blue-400 break-words">@TempData["name"]</p>
                </div>

                <div class="d-3 border rounded-lg p-4">
                    <p class="text-center text-gray-500">Contact</p>
                    <p class="text-center text-blue-400 break-words">@TempData["mobile"]</p>
                </div>

                <div class="d-3 border rounded-lg p-4">
                    <p class="text-center text-gray-500">Email</p>
                    <p class="text-center text-blue-400 break-words">@TempData["email"]</p>
                </div>

                <div class="d-3 border rounded-lg p-4">
                    <p class="text-center text-gray-500">Amount</p>
                    <p class="text-center text-blue-400"><i class="fa-solid fa-indian-rupee-sign"></i> @TempData["amount"]</p>
                </div>
            </div>

        </div>

        <p class="text-sm text-gray-500 mb-4 text-center">By clicking <span class="font-semibold">Pay Now</span>, you agree to our <a href="#" class="text-indigo-600 underline">terms</a> and <a href="#" class="text-indigo-600 underline">privacy policy</a>.</p>

        <p class="text-center mt-3">
            <button class="bg-blue-600 rounded-lg p-2 text-white" id="rzp-button1">Pay Now</button>
        </p>

        <div class="bg-gray-100 w-full p-3 text-center rounded-lg text-gray-500 mt-4">
            Need help? Contact <a class="text-indigo-600 underline" href="mailto:bajrangipatwa9@gmail.com">bajrangipatwa9@gmail.com</a>
        </div>
    </div>
</div>

<input type="hidden" id="inputamount" value="@TempData["amount"]" />
<input type="hidden" id="inputname" value="@TempData["name"]" />
<input type="hidden" id="inputemail" value="@TempData["email"]" />
<input type="hidden" id="inputmobile" value="@TempData["mobile"]" />

@* <button id="rzp-button1" class="btn btn-primary btn-lg mx-auto">Click to Pay Now</button> *@

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>

    document.getElementById('rzp-button1').onclick = function(e){

        document.getElementById('rzp-button1').ariaDisabled = true;

        var amount = inputamount.value;
    var name = inputname.value
    var email = inputemail.value
    var contact = inputmobile.value

    var options;

    fetch("https://phpcrud.himanshukashyap.com/rzp/createOrder.php?amount="+amount)
    .then((response)=>{
        return response.json();
    }).then( (data) => {

        console.log(data);

    options = {
        "key": data.key, // Enter the Key ID generated from the Dashboard
        "amount": amount, // Amount is in currency subunits.
        "currency": "INR",
        "name": "DigiCoders Technologies Pvt Ltd", //your business name
        "description": "Registration Fee Payment",
        "image": "https://thedigicoders.com/public/assets/images/logo.jpg",
        "order_id": data.token, // This is a sample Order ID. Pass the id obtained in the response of Step 1
        // "callback_url": "http:localhost:5008/Admin/RegistrationFee",
        "handler": function(response){
            window.location.href = "/Admin/RegistrationPaymentSuccess?paymentid="+response.razorpay_payment_id
        },
        "prefill": { //We recommend using the prefill parameter to auto-fill customer's contact information especially their phone number
            "name": name, //your customer's name
            "email": email,
            "contact": contact //Provide the customer's phone number for better conversion rates
        },
        "notes": {
            "address": "Aliganj, Lucknow, Uttar Pradesh"
        },
        "theme": {
            "color": "#ff0000"
        }
    };

    console.log(options);

        var rzp1 = new Razorpay(options);
        rzp1.on("payment.failed",function(response){
            window.location.href = "/Admin/RegistrationPaymentFailed";
        });
        rzp1.open();
        e.preventDefault();

        } );
    }

</script>
